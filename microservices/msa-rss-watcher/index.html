<!doctype html>
<html>
    <head>
        <meta content="IE=edge" http-equiv="X-UA-Compatible">
        <meta charset="utf-8">
        <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta name="description" content="Providing open source RESTful microservices in containers.">

        <title>msa-rss-watcher</title>

        <link href="/stylesheets/sidemenu.css" rel="stylesheet" />
        <link href="/stylesheets/site.css" rel="stylesheet" />
    </head>

    <body class="microservices microservices_msa-rss-watcher microservices_msa-rss-watcher_index">

        <div id="layout">
            <a href="#menu" id="menuLink" class="menu-link">
                <!-- Menu toggle -->
                <span></span>
                <!-- Hamburger icon -->
            </a>

            <div id="menu">
                <div class="pure-menu">
                    <a class="pure-menu-heading" href="/">The MSA</a>

                    <ul class="pure-menu-list">

                        <li class="pure-menu-item">
                            <a href="/" class="pure-menu-link">Homepage</a>
                        </li>

                        <li class="pure-menu-item">
                            <a href="/standard" class="pure-menu-link">The Standard</a>
                        </li>

                        <li class="pure-menu-item">
                            <a href="/templates" class="pure-menu-link">The Templates</a>
                        </li>

                        <li class="pure-menu-item menu-item-divided "></li>

                        <li class="pure-menu-item">
                            <a href="/microservices/" class="pure-menu-item">The Microservices</a>
                        </li>

                            <li class="pure-menu-item">
                                <a href="/microservices/msa-httpbin" class="pure-menu-link">msa-httpbin</a>
                            </li>
                            <li class="pure-menu-item">
                                <a href="/microservices/msa-faker" class="pure-menu-link">msa-faker</a>
                            </li>
                            <li class="pure-menu-item">
                                <a href="/microservices/msa-corpora" class="pure-menu-link">msa-corpora</a>
                            </li>
                            <li class="pure-menu-item">
                                <a href="/microservices/msa-world-factbook" class="pure-menu-link">msa-world-factbook</a>
                            </li>
                            <li class="pure-menu-item">
                                <a href="/microservices/msa-fakeimage" class="pure-menu-link">msa-fakeimage</a>
                            </li>
                            <li class="pure-menu-item">
                                <a href="/microservices/msa-string-similarity" class="pure-menu-link">msa-string-similarity</a>
                            </li>
                            <li class="pure-menu-item">
                                <a href="/microservices/msa-geohash" class="pure-menu-link">msa-geohash</a>
                            </li>
                            <li class="pure-menu-item">
                                <a href="/microservices/msa-geocoder" class="pure-menu-link">msa-geocoder</a>
                            </li>
                            <li class="pure-menu-item">
                                <a href="/microservices/msa-json-patch" class="pure-menu-link">msa-json-patch</a>
                            </li>
                            <li class="pure-menu-item">
                                <a href="/microservices/msa-rss-watcher" class="pure-menu-link">msa-rss-watcher</a>
                            </li>

                        <li class="pure-menu-item menu-item-divided "></li>

                        <li class="pure-menu-item">
                            <a href="/contribute" class="pure-menu-link">Contribute</a>
                        </li>

                        <li class="pure-menu-item">
                            <a href="/faq" class="pure-menu-link">FAQ</a>
                        </li>

                    </ul>
                </div>
            </div>

            <div id="main">
                
                <div class="content">

                  <div class="header">
                      <h1>msa-rss-watcher</h1>
                  </div>

                    <p><a href="https://github.com/TheMicroservicesAgency/msa-rss-watcher"><img style="zoom: 1.15; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" /></a></p>

<p>Microservice to watch RSS or Atom feeds, and trigger notifications via webhooks for new items.</p>

<p>Built using <a href="https://pypi.python.org/pypi/feedparser">feedparser</a>.</p>

<h2 id="quick-start">Quick start</h2>

<p>Execute the microservice container with the following command :</p>

<pre><code>docker run -ti -p 9010:80 msagency/msa-rss-watcher
</code></pre>

<h2 id="examples">Example(s)</h2>

<p>To create a new watch for a given feed, you only have to specify the feed URL, how often to fetch updates,
 and where to send new items notifications - the webhook.</p>

<pre><code>$ curl -X POST "http://localhost:9910/feeds" -H "Content-Type: application/json" -d '{
    "feed" : {
        "url" : "http://rss.nytimes.com/services/xml/rss/nyt/World.xml",
        "refresh_secs": 30,
        "webhook": "http://requestb.in/1mshtpk1"
    }
}'

{
  "data": {
    "feed": {
      "id": "12fd97",
      "refresh_secs": 30,
      "url": "http://rss.nytimes.com/services/xml/rss/nyt/World.xml",
      "webhook": "https://httpbin.org/post"
    }
  }
}
</code></pre>

<p>If the feed creation is sucessful you will get back the created feed definition, containing a unique ID.
The ID is the 6 first chars of the SHA256 signature of the feed URL.</p>

<p>In this example the NYTimes RSS feed willl be polled every minute, and new items will trigger a POST request
to http://requestb.in/1mshtpk1 - a JSON doc containing the item link, title, summary and published time. Example:</p>

<pre><code>{  
   "data":{  
      "summary":"A worker on the outside wall of the Reactor 2 building at the Fukushima Daiichi Nuclear Power Station last month.",
      "title":"Struggling With Japan\u2019s Nuclear Waste, Six Years After Disaster",
      "published":"2017-03-11T21:00:31Z",
      "link":"http://www.nytimes.com/2017/03/11/world/asia/struggling-with-japans-nuclear-waste-six-years-after-disaster.html?partner=rss&amp;emc=rss"
   }
}
</code></pre>

<p>To see the full of watched feeds, simply do a HTTP GET request :</p>

<pre><code>$ curl "http://localhost:9910/feeds"

{
  "data": {
    "feeds": [
      {
        "id": "12fd97",
        "items_cached": 12,
        "items_fetched": 24,
        "notifications_sent": 12,
        "refresh_secs": 30,
        "time_first_fetch": "2017-03-12T18:18:57.597617Z",
        "time_last_fetch": "2017-03-12T18:19:28.071164Z",
        "url": "http://rss.nytimes.com/services/xml/rss/nyt/World.xml",
        "webhook": "https://httpbin.org/post"
      }
    ]
  }
}
</code></pre>

<p>To see the last items fetched for a given feed, specify the feed ID :</p>

<pre><code>$ curl "http://localhost:9910/feeds/12fd97"

{
  "data": {
    "feed": {
      "id": "12fd97",
      "items_cached": 12,
      "items_fetched": 24,
      "notifications_sent": 12,
      "refresh_secs": 30,
      "time_first_fetch": "2017-03-12T18:18:57.597617Z",
      "time_last_fetch": "2017-03-12T18:19:28.071164Z",
      "url": "http://rss.nytimes.com/services/xml/rss/nyt/World.xml",
      "webhook": "https://httpbin.org/post"
    },
    "feed_last_items": [
      {
        "link": "http://www.nytimes.com/2017/03/12/business/dealbook/china-deals-capital-controls-hollywood.html?partner=rss&amp;emc=rss",
        "published": "2017-03-12T14:53:44Z",
        "summary": "Zhong Shan, China\u2019s commerce minister, castigated what he called \u201cblind and irrational investment,\u201d at a briefing during the annual meeting of the country\u2019s congress.",
        "title": "After $225 Billion in Deals Last Year, China Reins In Overseas Investment"
      },
      {
        "link": "http://www.nytimes.com/2017/03/12/world/europe/russia-hacker-evgeniy-bogachev.html?partner=rss&amp;emc=rss",
        "published": "2017-03-12T14:51:08Z",
        "summary": "Evgeniy M. Bogachev. The F.B.I. has offered a $3 million bounty for his capture, the most ever for a cybercriminal.",
        "title": "Russian Espionage Piggybacks on a Cybercriminal\u2019s Hacking"
      },
     ...
</code></pre>

<p>To stop watching a feed send a HTTP DELETE with the feed ID.</p>

<pre><code>$ curl -XDELETE http://localhost:9910/feeds/12fd97

{
  "data": {
    "feed": {
      "id": "12fd97",
      "items_cached": 12,
      "items_fetched": 48,
      "notifications_sent": 12,
      "refresh_secs": 30,
      "time_first_fetch": "2017-03-12T18:18:57.597617Z",
      "time_last_fetch": "2017-03-12T18:20:29.663288Z",
      "url": "http://rss.nytimes.com/services/xml/rss/nyt/World.xml",
      "webhook": "https://httpbin.org/post"
    }
  }
}

$ curl http://localhost:9910/feeds

{
  "data": {
    "feeds": []
  }
}
</code></pre>

<h2 id="endpoints">Endpoints</h2>

<ul>
  <li>POST <a href="">/feeds</a> : watches a new feed for new updates</li>
  <li>GET <a href="http://demo.microservices.agency:9910/feeds">/feeds</a> : returns the list of currently watched feeds</li>
  <li>GET <a href="">/feeds/:id</a> : get last items fetched of a given feed</li>
  <li>DELETE <a href="">/feeds/:id</a> : stop watching the given RSS feed</li>
</ul>

<h2 id="standard-endpoints">Standard endpoints</h2>

<ul>
  <li>GET <a href="http://demo.microservices.agency:9910/ms/version">/ms/version</a> : returns the version number</li>
  <li>GET <a href="http://demo.microservices.agency:9910/ms/name">/ms/name</a> : returns the name</li>
  <li>GET <a href="http://demo.microservices.agency:9910/ms/readme.md">/ms/readme.md</a> : returns the readme (this file)</li>
  <li>GET <a href="http://demo.microservices.agency:9910/ms/readme.html">/ms/readme.html</a> : returns the readme as html</li>
  <li>GET <a href="http://demo.microservices.agency:9910/swagger/swagger.json">/swagger/swagger.json</a> : returns the swagger api documentation</li>
  <li>GET <a href="http://demo.microservices.agency:9910/swagger/#/">/swagger/#/</a> : returns swagger-ui displaying the api documentation</li>
  <li>GET <a href="http://demo.microservices.agency:9910/nginx/stats.json">/nginx/stats.json</a> : returns stats about Nginx</li>
  <li>GET <a href="http://demo.microservices.agency:9910/nginx/stats.html">/nginx/stats.html</a> : returns a dashboard displaying the stats from Nginx</li>
</ul>

<h2 id="about">About</h2>

<p>A project by the <a href="http://microservices.agency">Microservices Agency</a>.</p>

                </div>

            </div>
        </div>

        <script src="/javascripts/side_menu.js"></script>
        <script src="/javascripts/analytics.js"></script>
    </body>
</html>
